/*
 * app_mode_dvt_test.c
 *
 *  Created on: Dec 12, 2023
 *      Author: louie.liu
 */
#include "app_mode_dvt_test.h"
#include "app_config.h"

typedef struct {
	uint8_t Opcode;
	uint8_t PayloadLen;
	uint8_t Payload[20];
} testCmd_Req_t;

static Cmd_Req_t test_cmd_gen(testCmd_Req_t testCmd) {
	Cmd_Req_t cmd;
	cmd.Opcode = testCmd.Opcode;
	cmd.Payload = testCmd.Payload;
	cmd.PayloadLen = testCmd.PayloadLen;
	return cmd;
}

const testCmd_Req_t swTestCmds[] = {
		{
				OP_PING,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_TEST_INFORMATION,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_SET_SAMPLE_ID,
				2,
				{
						0xEE, 0xFF,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_SAMPLE_ID,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_SET_DVT_MODE,
				1,
				{
						0x01,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
};

const testCmd_Req_t gpioTestCmds[] = {
//		{
//				OP_IPG_SHUTDOWN,
//				0,
//				{
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//				}
//		},
		{
				OP_GET_MAG_STATUS,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
};

const testCmd_Req_t vddTestCmds[] = {
		{
				OP_ENABLE_VDDS_SUPPLY,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_ENABLE_VDDA_SUPPLY,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_DISABLE_VDDS_SUPPLY,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_DISABLE_VDDA_SUPPLY,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
};

const testCmd_Req_t highVoltTestCmds[] = {
		{
				OP_TURN_ON_HV_SUPPLY,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_ENABLE_HV_SUPPLY,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_SET_HV_SUPPLY_VOLTAGE_VALUE,
				2,
				{
						0x50, 0x2D,	//11600mV
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_DISABLE_HV_SUPPLY,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
};

const testCmd_Req_t battTestCmds[] = {
		{
				OP_ENABLE_BATTERY_MONITOR,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_BATTERY_VOLTAGE_MEASUREMENT,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
};

const testCmd_Req_t stimTestCmds[] = {
		{
				OP_TURN_ON_HV_SUPPLY,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_ENABLE_HV_SUPPLY,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_SET_HV_SUPPLY_VOLTAGE_VALUE,
				2,
				{
						0x50, 0x2D,	//11600mV
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_ENABLE_VDDS_SUPPLY,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_SET_DAC_AB_OUTPUT_VOLTAGE,
				4,
				{
						0x3D, 0x01, //317mV = 0.5mA
						0x3D, 0x01, //317mV = 0.5mA
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_SET_STIMULUS_CIRCUIT_PARAMETERS,
				13,
				{
						0x64, 0x00, //100us
						0xC8, 		//200ms
						0xE8, 0x03, //1000us
						0x2C, 0x01, //300us
						0x96, 		//150ms
						0xD0, 0x07,	//2000us
						0x0A, 		//10Hz
						0xC8, 0x00, //200ms
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_SET_CURRENT_SOURCES_CONFIGURATION,
				7,
				{
						0x01, //src1
						0x01, //src2
						0x01, //snk1
						0x01, //snk2
						0x01, //snk3
						0x01, //snk4
						0x00, //snk5
						0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_ENABLE_STIMULUS_CIRCUIT,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_SET_STIM_SEL_POSITIONS,
				7,
				{
						STIMA_SEL_STIM1, //STIM1
						STIMB_SEL_STIM2, //STIM2
						0x00,	//encl
						STIM_SEL_CH1_STIMA, 	//ch1
						STIM_SEL_CH2_SINK_CH2, 	//ch2
						STIM_SEL_CH3_STIMB, 	//ch3
						STIM_SEL_CH4_SINK_CH4, 	//ch4
						0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_ENABLE_CHANNEL_MUX,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_ENABLE_VNS_STIMULATION,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GENERATE_MOCKED_STIMULUS,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
};

const testCmd_Req_t impTestCmds[] = {
		{
				OP_TURN_ON_HV_SUPPLY,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_ENABLE_HV_SUPPLY,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_SET_HV_SUPPLY_VOLTAGE_VALUE,
				2,
				{
						0x68, 0x10,	//4200mV
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_ENABLE_VDDS_SUPPLY,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_SET_DAC_AB_OUTPUT_VOLTAGE,
				4,
				{
						0x3D, 0x01, //317mV
						0x00, 0x00, //0mV
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_SET_STIMULUS_CIRCUIT_PARAMETERS,
				13,
				{
						0xF4, 0x01, //500us
						0xC8, 		//200ms
						0x10, 0x27, //10000us
						0xF4, 0x01, //500us
						0xC8, 		//200ms
						0x10, 0x27, //10000us
						0x0A, 		//10Hz
						0xC8, 0x00, //200ms
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_SET_CURRENT_SOURCES_CONFIGURATION,
				7,
				{
						0x01, //src1
						0x00, //src2
						0x01, //snk1
						0x01, //snk2
						0x00, //snk3
						0x00, //snk4
						0x00, //snk5
						0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_ENABLE_STIMULUS_CIRCUIT,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_SET_STIM_SEL_POSITIONS,
				7,
				{
						STIMA_SEL_STIM1, //STIM1
						0x00, 	//STIM2
						0x00,	//encl
						STIM_SEL_CH1_STIMA, 	//ch1
						STIM_SEL_CH2_SINK_CH2, 	//ch2
						0x00, 	//ch3
						0x00, 	//ch4
						0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_ENABLE_CHANNEL_MUX,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_ENABLE_IMC,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_SET_IMP_SEL_POSITIONS,
				4,
				{
						0x01, //IMP-, sel0, SINK_CH2
						0x00, //IMP-, sel1, SINK_CH2
						0x00, //IMP-, sel2, SINK_CH2
						0x00, //IMP+, sel0, STIMA
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GENERATE_MOCKED_STIMULUS,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_IMC_MEASURE,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
};

const testCmd_Req_t sensorTestCmds[] = {
		{
				OP_ENABLE_VDDA_SUPPLY,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
//		{
//				OP_ENABLE_ECG_HR_AFE,
//				0,
//				{
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//				}
//		},
//		{
//				OP_GET_ECG_HR_LOD,
//				0,
//				{
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//				}
//		},
//		{
//				OP_GET_ECG_HR_AFE_OUTPUT,
//				3,
//				{
//						0xEE, 			//238byte, Buffer size
//						0xE8, 0x03, 	//1000Hz, Sampling frequency
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//				}
//		},
//		{
//				OP_GET_ECG_HR_AFE_OUTPUT,
//				3,
//				{
//						0xEE, 			//238byte, Buffer size
//						0xE8, 0x03, 	//1000Hz, Sampling frequency
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//				}
//		},
//		{
//				OP_GET_ECG_HR_AFE_OUTPUT,
//				3,
//				{
//						0xEE, 			//238byte, Buffer size
//						0xE8, 0x03, 	//1000Hz, Sampling frequency
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//				}
//		},
//		{
//				OP_DISABLE_ECG_HR_AFE,
//				0,
//				{
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//				}
//		},
//		{
//				OP_ENABLE_ECG_RR_AFE,
//				0,
//				{
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//				}
//		},
//		{
//				OP_GET_ECG_RR_LOD,
//				0,
//				{
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//				}
//		},
//		{
//				OP_GET_ECG_RR_AFE_OUTPUT,
//				3,
//				{
//						0xEE, 			//238byte, Buffer size
//						0xE8, 0x03, 	//1000Hz, Sampling frequency
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//				}
//		},
//		{
//				OP_GET_ECG_RR_AFE_OUTPUT,
//				3,
//				{
//						0xEE, 			//238byte, Buffer size
//						0xE8, 0x03, 	//1000Hz, Sampling frequency
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//				}
//		},
//		{
//				OP_GET_ECG_RR_AFE_OUTPUT,
//				3,
//				{
//						0xEE, 			//238byte, Buffer size
//						0xE8, 0x03, 	//1000Hz, Sampling frequency
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//				}
//		},
//		{
//				OP_DISABLE_ECG_RR_AFE,
//				0,
//				{
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//				}
//		},
//		{
//				OP_ENABLE_ENG1_AFE,
//				0,
//				{
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//				}
//		},
//		{
//				OP_GET_ENG1_LOD,
//				0,
//				{
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//				}
//		},
//		{
//				OP_GET_ENG1_AFE_OUTPUT,
//				3,
//				{
//						0xEE, 			//238byte, Buffer size
//						0xE8, 0x03, 	//1000Hz, Sampling frequency
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//				}
//		},
//		{
//				OP_DISABLE_ENG1_AFE,
//				0,
//				{
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
//				}
//		},
		{
				OP_ENABLE_ENG2_AFE,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_ENG2_LOD,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_ENG2_AFE_OUTPUT,
				3,
				{
						0xEE, 			//238byte, Buffer size
						0xE8, 0x03, 	//1000Hz, Sampling frequency
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_DISABLE_ENG2_AFE,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
};

const testCmd_Req_t chargeTestCmds[] = {
		{
				OP_ENABLE_WPT_VRECT_MON_CIRCUIT,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_WPT_VRECT_MON_CIRCUIT_OUTPUT,
				3,
				{
						0xEE, 			//238byte, Buffer size
						0xE8, 0x03, 	//1000Hz, Sampling frequency
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_VRECT_DET,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_VRECT_OVP,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_ENABLE_VCHG_RAIL_SUPPLY,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_VCHG_RAIL_SUPPLY_CIRCUIT_POWER_GOOD,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_ENABLE_CHARGE_CONTROL_1_CIRCUIT,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_ENABLE_CHARGE_CONTROL_2_CIRCUIT,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_CHARGE_RATE_CONTROL,
				2,
				{
						0x01, //chgRate1
						0x01, //chgRate2
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_CHG1_STATUS,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_CHG2_STATUS,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_CHG1_OVP_ERR,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_CHG2_OVP_ERR,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
};

const testCmd_Req_t thermTestCmds[] = {
		{
				OP_ENABLE_THERMISTOR_INTERFACE_CIRCUIT,
				0,
				{
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_THERM_REF,
				3,
				{
						0xEE, 			//238byte, Buffer size
						0xE8, 0x03, 	//1000Hz, Sampling frequency
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_THERM_OUT,
				3,
				{
						0xEE, 			//238byte, Buffer size
						0xE8, 0x03, 	//1000Hz, Sampling frequency
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_THERM_OFST,
				3,
				{
						0xEE, 			//238byte, Buffer size
						0xE8, 0x03, 	//1000Hz, Sampling frequency
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
};

const testCmd_Req_t accTestCmds[] = {
		{
				OP_START_ACC,
				2,
				{
						0x64, 0x98, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_START_ACC,
				2,
				{
						0x64, 0x99, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_DATA_ACC,
				1,
				{
						0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_DATA_ACC,
				1,
				{
						0x19, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_DATA_ACC,
				1,
				{
						0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_GET_DATA_ACC,
				1,
				{
						0x19, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_STOP_ACC,
				1,
				{
						0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
		{
				OP_STOP_ACC,
				1,
				{
						0x19, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
						0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				}
		},
};

#define TEST_CMDS		accTestCmds
#define TEST_INTERVAL	250

static int step = 0;
static Cmd_Req_t cmd_Simulate;
static uint32_t  ms_tick = 0U;

void app_mode_dvt_test_handler(void) {
	if (step < (sizeof(TEST_CMDS)/sizeof(testCmd_Req_t))) {
		while (HAL_GetTick() < (ms_tick + TEST_INTERVAL)) {
			HAL_Delay(1);
		}
		cmd_Simulate = test_cmd_gen(TEST_CMDS[step]);
		step++;

		sp_uart.rx.data[0] = cmd_Simulate.Opcode;
		sp_uart.rx.data[1] = cmd_Simulate.PayloadLen;
		if (cmd_Simulate.PayloadLen > 0 && cmd_Simulate.Payload != NULL) {
			for(uint8_t i=0;i<cmd_Simulate.PayloadLen;i++) {
				sp_uart.rx.data[LEN_REQ_HEADER + i] = cmd_Simulate.Payload[i];
			}
		}
		uint16_t cal_crc16 = HAL_CRC_Calculate(&hcrc, (uint32_t*)sp_uart.rx.data, LEN_REQ_HEADER + cmd_Simulate.PayloadLen);
		memcpy(&sp_uart.rx.data[LEN_REQ_HEADER + cmd_Simulate.PayloadLen], (uint8_t*)&cal_crc16, LEN_CRC);
		sp_uart.rx.len = LEN_REQ_HEADER + cmd_Simulate.PayloadLen + LEN_CRC;
		while(HANDLE_DEBUG_UART.gState != HAL_UART_STATE_READY);
		HAL_UART_Transmit(&HANDLE_DEBUG_UART, (uint8_t*)sp_uart.rx.data, sp_uart.rx.len, 10);
		ms_tick = HAL_GetTick();
	}
}

